<div class="app-shell" [class.sidebar-open]="sidebarOpen">
  <aside class="sidebar" [class.open]="sidebarOpen">
    <div class="sidebar-header">
      <i class="pi pi-th-large logo" aria-hidden="true"></i>
      <span class="brand">StellarEMS</span>
      <button class="close-btn" (click)="toggleSidebar()" aria-label="Close sidebar">
        <i class="pi pi-times" aria-hidden="true"></i>
      </button>
    </div>
    <nav class="menu" #menuNav>
      <a class="menu-item" *ngIf="allow('/dashboard')" routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
        <i class="pi pi-home" aria-hidden="true"></i>
        <span>Dashboard</span>
      </a>


        <a class="menu-item" *ngIf="allow('/staffs')" routerLink="/staffs" routerLinkActive="active">
            <i class="pi pi-users" aria-hidden="true"></i>
            <span>Staff</span>
        </a>


        <a class="menu-item" *ngIf="allow('/students')" routerLink="/students" routerLinkActive="active">
            <i class="pi pi-users" aria-hidden="true"></i>
            <span>Students</span>
        </a>

        <a class="menu-item" *ngIf="allow('/guardians')" routerLink="/guardians" routerLinkActive="active">
            <i class="pi pi-users" aria-hidden="true"></i>
            <span>Guardians</span>
        </a>

        <a class="menu-item" *ngIf="allow('/class-members')" routerLink="/class-members" routerLinkActive="active">
            <i class="pi pi-briefcase" aria-hidden="true"></i>
            <span>Class Members</span>
        </a>

        <a class="menu-item" *ngIf="allow('/attendance')" routerLink="/attendance" routerLinkActive="active">
        <i class="pi pi-briefcase" aria-hidden="true"></i>
        <span>Attendance</span>
      </a>

        <a class="menu-item" *ngIf="allow('/attendance-devices')" routerLink="/attendance-devices" routerLinkActive="active">
        <i class="pi pi-briefcase" aria-hidden="true"></i>
        <span>Attendance Devices</span>
      </a>

        <a class="menu-item" *ngIf="allow('/settings')" routerLink="/settings" routerLinkActive="active">
            <i class="pi pi-briefcase" aria-hidden="true"></i>
            <span>Settings</span>
        </a>

        <a class="menu-item" *ngIf="allow('/classes')" routerLink="/classes" routerLinkActive="active">
        <i class="pi pi-briefcase" aria-hidden="true"></i>
        <span>Classes</span>
      </a>


      <a class="menu-item" *ngIf="allow('/buy-credit')" routerLink="/buy-credit" routerLinkActive="active">
        <i class="pi pi-wallet" aria-hidden="true"></i>
        <span>Buy Message Credit</span>
      </a>


      <a class="menu-item" *ngIf="allow('/group-contacts')" routerLink="/group-contacts" routerLinkActive="active">
        <i class="pi pi-address-book" aria-hidden="true"></i>
        <span>Group Contacts</span>
      </a>
      <a class="menu-item" *ngIf="allow('/send-sms')" routerLink="/send-sms" routerLinkActive="active">
        <i class="pi pi-send" aria-hidden="true"></i>
        <span>Send SMS</span>
      </a>
      <a class="menu-item" *ngIf="allow('/sms-records')" routerLink="/sms-records" routerLinkActive="active">
        <i class="pi pi-inbox" aria-hidden="true"></i>
        <span>SMS Records</span>
      </a>


      <a class="menu-item" *ngIf="allow('/notification-settings')" routerLink="/notification-settings" routerLinkActive="active">
        <i class="pi pi-bell" aria-hidden="true"></i>
        <span>Notification Settings</span>
      </a>

      <a class="menu-item" *ngIf="allow('/school-config')" routerLink="/school-config" routerLinkActive="active">
        <i class="pi pi-cog" aria-hidden="true"></i>
        <span>School Config</span>
      </a>

    </nav>

      <div id="termDetails" class="flex justify-content-center term-details">
          <div><strong>Academic Year:</strong> {{ termDetails.academicYearName }}</div>
          <div><strong>Term:</strong> {{ termDetails.termEnumLabel }}</div>
        <div><strong>Term Code:</strong> {{ termDetails.termCode }}</div>
        <div><strong>Start Date:</strong> {{ termDetails.startDate | date}}</div>
        <div><strong>End Date:</strong> {{ termDetails.endDate | date }}</div>
        <div><strong>Next Term Begins:</strong> {{ termDetails.nextTermBeginDate |date}}</div>
      </div>

  </aside>

  <div class="overlay" (click)="closeSidebar()" [class.show]="isMobile && sidebarOpen"></div>

  <header class="topbar">
    <button class="hamburger" (click)="toggleSidebar()" aria-label="Toggle sidebar">
      <i class="pi pi-bars" aria-hidden="true"></i>
    </button>
    <div class="topbar-brand-container">
      <div class="topbar-brand">
        <span class="brand"><span class="brand-eco">Stellar</span> <span class="brand-mms">EMS</span></span>
      </div>
    </div>

    <div class="topbar-actions">
      <button class="theme-btn" (click)="toggleTheme()" [attr.aria-label]="'Switch to ' + (theme==='light' ? 'dark' : 'light') + ' theme'">
        <i class="pi" [ngClass]="theme==='light' ? 'pi-moon' : 'pi-sun'" aria-hidden="true"></i>
      </button>
      <div class="user" (click)="toggleUserMenu($event)" role="button" tabindex="0" aria-haspopup="true" [attr.aria-expanded]="showUserMenu">
        <img [src]="user.avatar" [alt]="user.memberName" />
<!--        <img src="https://i.pravatar.cc/40" alt="User avatar">-->
        <span class="name">{{user.name}}</span>
      </div>
      <div class="user-menu" *ngIf="showUserMenu" (click)="$event.stopPropagation()">
        <a class="user-menu-item" routerLink="/profile" routerLinkActive="active" (click)="showUserMenu=false">
          <i class="pi pi-user" aria-hidden="true"></i>
          <span>Profile</span>
        </a>
        <a class="user-menu-item" routerLink="/update-password" routerLinkActive="active" (click)="showUserMenu=false">
          <i class="pi pi-key" aria-hidden="true"></i>
          <span>Update Password</span>
        </a>
        <a class="user-menu-item" href="#" (click)="logout()" >
          <i class="pi  pi-sign-out" aria-hidden="true"></i>
          <span>Log Out</span>
        </a>

      </div>
    </div>
  </header>

  <main class="content">
    <div class="container-fluid">
      <router-outlet />
    </div>
  </main>
</div>
